{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory name",
			"defaultValue": "EAL-MAIN-ADF"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/SF_source_shift')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "eal_main_blob_connection",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "Azure blob"
				},
				"annotations": [],
				"type": "Json",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"fileName": {
							"value": "@concat(concat('bi-shift-',split(utcnow(),'T')[0]),'.json')",
							"type": "Expression"
						},
						"container": "sf-source-shift"
					}
				},
				"schema": {
					"type": "object",
					"properties": {
						"shift_id": {
							"type": "integer"
						},
						"user_id": {
							"type": "integer"
						},
						"name": {
							"type": "string"
						},
						"start_time": {
							"type": "string"
						},
						"end_time": {
							"type": "string"
						},
						"type": {
							"type": "string"
						},
						"is_work": {
							"type": "boolean"
						},
						"is_reserve": {
							"type": "boolean"
						},
						"is_sick": {
							"type": "boolean"
						},
						"is_training": {
							"type": "boolean"
						},
						"is_vacation": {
							"type": "boolean"
						},
						"updated_at": {
							"type": "string"
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SF_source_user')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "eal_main_blob_connection",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "Azure blob"
				},
				"annotations": [],
				"type": "Json",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"fileName": {
							"value": "@concat(concat('bi-user-',split(utcnow(),'T')[0]),'.json')",
							"type": "Expression"
						},
						"container": "sf-source-user"
					}
				},
				"schema": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SF_source_user_category')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "eal_main_blob_connection",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "Azure blob"
				},
				"annotations": [],
				"type": "Json",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"fileName": {
							"value": "@concat(concat('bi-user-category-',split(utcnow(),'T')[0]),'.json')",
							"type": "Expression"
						},
						"container": "sf-source-user-category"
					}
				},
				"schema": {
					"type": "object",
					"properties": {
						"user_id": {
							"type": "integer"
						},
						"category_type": {
							"type": "string"
						},
						"effective_start": {
							"type": "string"
						},
						"effective_end": {
							"type": "null"
						},
						"base_icao_code": {
							"type": "string"
						},
						"base_iata_code": {
							"type": "string"
						},
						"base_faa_code": {
							"type": "string"
						},
						"base_name": {
							"type": "string"
						},
						"equipment_group_name": {
							"type": "string"
						},
						"equipment_group_code": {
							"type": "string"
						},
						"position_name": {
							"type": "string"
						},
						"position_code": {
							"type": "string"
						},
						"updated_at": {
							"type": "string"
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SQL_AIRPORT_TABLE')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "eal_edw_connection",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "SQL tables"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [
					{
						"name": "airport_id",
						"type": "nvarchar"
					},
					{
						"name": "iata_code",
						"type": "nvarchar"
					},
					{
						"name": "icao_code",
						"type": "nvarchar"
					},
					{
						"name": "faa_code",
						"type": "nvarchar"
					},
					{
						"name": "airport_name",
						"type": "nvarchar"
					},
					{
						"name": "city_name",
						"type": "nvarchar"
					},
					{
						"name": "state_code",
						"type": "nvarchar"
					},
					{
						"name": "country_code",
						"type": "nvarchar"
					},
					{
						"name": "weather_zone",
						"type": "nvarchar"
					},
					{
						"name": "latitude",
						"type": "float"
					},
					{
						"name": "longitude",
						"type": "float"
					},
					{
						"name": "elevation_feet",
						"type": "smallint"
					},
					{
						"name": "iana_timezone",
						"type": "nvarchar"
					},
					{
						"name": "is_base",
						"type": "bit"
					},
					{
						"name": "base_initial",
						"type": "nvarchar"
					},
					{
						"name": "is_active",
						"type": "bit"
					},
					{
						"name": "is_deleted",
						"type": "bit"
					},
					{
						"name": "ADF_TIMESTAMP",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "RUN_ID",
						"type": "nvarchar"
					}
				],
				"typeProperties": {
					"schema": "dbo",
					"table": "SF_AIRPORT_PROD"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SQL_DELAYS_TABLE')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "eal_edw_connection",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "SQL tables"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [
					{
						"name": "flight_id",
						"type": "int"
					},
					{
						"name": "delay_type",
						"type": "nvarchar"
					},
					{
						"name": "duration_mins",
						"type": "smallint"
					},
					{
						"name": "delay_code",
						"type": "nvarchar"
					},
					{
						"name": "delay_code_name",
						"type": "nvarchar"
					},
					{
						"name": "ADF_TIMESTAMP",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "RUN_ID",
						"type": "nvarchar"
					}
				],
				"typeProperties": {
					"schema": "dbo",
					"table": "SF_DELAYS_PROD"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SQL_EQUIP_SCHED_TABLE')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "eal_edw_connection",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "SQL tables"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [
					{
						"name": "eqp_sched_id",
						"type": "nvarchar"
					},
					{
						"name": "ac_registration",
						"type": "nvarchar"
					},
					{
						"name": "status_code",
						"type": "nvarchar"
					},
					{
						"name": "status_name",
						"type": "nvarchar"
					},
					{
						"name": "status_description",
						"type": "nvarchar"
					},
					{
						"name": "start_time",
						"type": "datetime"
					},
					{
						"name": "end_time",
						"type": "datetime"
					},
					{
						"name": "notes",
						"type": "nvarchar"
					},
					{
						"name": "is_deleted",
						"type": "bit"
					},
					{
						"name": "updated_at",
						"type": "datetime"
					},
					{
						"name": "ADF_TIMESTAMP",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "RUN_ID",
						"type": "nvarchar"
					}
				],
				"typeProperties": {
					"schema": "dbo",
					"table": "SF_EQUIP_SCHED_PROD"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SQL_FLIGHT_CREW_TABLE')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "eal_edw_connection",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "SQL tables"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {
					"schema": "dbo",
					"table": "SF_FLIGHT_CREW_PROD"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SQL_FLIGHT_OFFLINE_TABLE')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "eal_edw_connection",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "SQL tables"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {
					"schema": "dbo",
					"table": "SQL_FLIGHT_OFFLINE_PROD"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SQL_FLIGHT_TABLE')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "eal_edw_connection",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "SQL tables"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [
					{
						"name": "actual_arrival_airport",
						"type": "nvarchar"
					},
					{
						"name": "actual_arrive_airport_id",
						"type": "nvarchar"
					},
					{
						"name": "actual_depart_airport_id",
						"type": "nvarchar"
					},
					{
						"name": "actual_departure_airport",
						"type": "nvarchar"
					},
					{
						"name": "actual_oooi_in",
						"type": "datetime"
					},
					{
						"name": "actual_oooi_off",
						"type": "datetime"
					},
					{
						"name": "actual_oooi_on",
						"type": "datetime"
					},
					{
						"name": "actual_oooi_out",
						"type": "datetime"
					},
					{
						"name": "aircraft_registration_number",
						"type": "nvarchar"
					},
					{
						"name": "aircraft_type",
						"type": "nvarchar"
					},
					{
						"name": "base_airport",
						"type": "nvarchar"
					},
					{
						"name": "base_airport_id",
						"type": "nvarchar"
					},
					{
						"name": "cargo_off",
						"type": "int"
					},
					{
						"name": "cargo_on",
						"type": "int"
					},
					{
						"name": "cargo_weight",
						"type": "int"
					},
					{
						"name": "estimated_arrival",
						"type": "datetime"
					},
					{
						"name": "estimated_departure",
						"type": "datetime"
					},
					{
						"name": "flight_date",
						"type": "date"
					},
					{
						"name": "flight_id",
						"type": "int"
					},
					{
						"name": "flight_number",
						"type": "nvarchar"
					},
					{
						"name": "flight_type",
						"type": "nvarchar"
					},
					{
						"name": "fuel_in",
						"type": "float"
					},
					{
						"name": "fuel_out",
						"type": "float"
					},
					{
						"name": "fuel_uplift",
						"type": "int"
					},
					{
						"name": "fuel_uplifts",
						"type": "nvarchar"
					},
					{
						"name": "is_canceled",
						"type": "nvarchar"
					},
					{
						"name": "is_verified",
						"type": "nvarchar"
					},
					{
						"name": "lndg_actual_braking",
						"type": "nvarchar"
					},
					{
						"name": "lndg_midfield",
						"type": "nvarchar"
					},
					{
						"name": "lndg_rollout",
						"type": "nvarchar"
					},
					{
						"name": "lndg_touchdown_zone",
						"type": "nvarchar"
					},
					{
						"name": "maint_log_page",
						"type": "nvarchar"
					},
					{
						"name": "notes",
						"type": "nvarchar"
					},
					{
						"name": "ops_type",
						"type": "nvarchar"
					},
					{
						"name": "sched_arrive_airport_id",
						"type": "nvarchar"
					},
					{
						"name": "sched_depart_airport_id",
						"type": "nvarchar"
					},
					{
						"name": "scheduled_arrival",
						"type": "datetime2"
					},
					{
						"name": "scheduled_arrival_airport",
						"type": "nvarchar"
					},
					{
						"name": "scheduled_departure",
						"type": "datetime"
					},
					{
						"name": "scheduled_departure_airport",
						"type": "nvarchar"
					},
					{
						"name": "updated_at",
						"type": "datetime"
					},
					{
						"name": "ADF_TIMESTAMP",
						"type": "datetime",
						"scale": 7
					},
					{
						"name": "RUN_ID",
						"type": "nvarchar"
					}
				],
				"typeProperties": {
					"schema": "dbo",
					"table": "SF_FLIGHT_PROD"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SQL_FLT_TABLE_TEST')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "eal_edw_connection",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {
					"schema": "dbo",
					"table": "SQL_FLIGHT_TABLE_TEST"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SQL_MIS_CHOICE_PAX_BAGS_TABLE')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "eal_edw_connection",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "SQL tables"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {
					"schema": "dbo",
					"table": "MIS_PAX_BAGS_TEST"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SQL_PAIRING_ITEM_TABLE')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "eal_edw_connection",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "SQL tables"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [
					{
						"name": "pairing_id",
						"type": "nvarchar"
					},
					{
						"name": "pairing_item_id",
						"type": "nvarchar"
					},
					{
						"name": "pairing_item_type",
						"type": "nvarchar"
					},
					{
						"name": "flight_id",
						"type": "nvarchar"
					},
					{
						"name": "shift_name",
						"type": "nvarchar"
					},
					{
						"name": "shift_start_time",
						"type": "datetime"
					},
					{
						"name": "shift_end_time",
						"type": "datetime"
					},
					{
						"name": "shift_type",
						"type": "nvarchar"
					},
					{
						"name": "shift_is_work",
						"type": "bit"
					},
					{
						"name": "shift_is_reserve",
						"type": "bit"
					},
					{
						"name": "shift_is_sick",
						"type": "bit"
					},
					{
						"name": "shift_is_training",
						"type": "bit"
					},
					{
						"name": "shift_is_vacation",
						"type": "bit"
					},
					{
						"name": "updated_at",
						"type": "datetime"
					},
					{
						"name": "ADF_TIMESTAMP",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "RUN_ID",
						"type": "nvarchar"
					}
				],
				"typeProperties": {
					"schema": "dbo",
					"table": "SF_PAIRING_ITEM_PROD"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SQL_PAIRING_TABLE')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "eal_edw_connection",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "SQL tables"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [
					{
						"name": "date",
						"type": "date"
					},
					{
						"name": "end_date",
						"type": "date"
					},
					{
						"name": "name",
						"type": "nvarchar"
					},
					{
						"name": "pairing_id",
						"type": "nvarchar"
					},
					{
						"name": "position",
						"type": "nvarchar"
					},
					{
						"name": "start_date",
						"type": "date"
					},
					{
						"name": "updated_at",
						"type": "nvarchar"
					},
					{
						"name": "user_id",
						"type": "nvarchar"
					},
					{
						"name": "ADF_TIMESTAMP",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "RUN_ID",
						"type": "nvarchar"
					}
				],
				"typeProperties": {
					"schema": "dbo",
					"table": "SF_PAIRING_PROD"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SQL_SHIFT_TABLE')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "eal_edw_connection",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "SQL tables"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [
					{
						"name": "shift_id",
						"type": "nvarchar"
					},
					{
						"name": "user_id",
						"type": "nvarchar"
					},
					{
						"name": "name",
						"type": "nvarchar"
					},
					{
						"name": "start_time",
						"type": "datetime"
					},
					{
						"name": "end_time",
						"type": "datetime"
					},
					{
						"name": "type",
						"type": "nvarchar"
					},
					{
						"name": "is_work",
						"type": "bit"
					},
					{
						"name": "is_reserve",
						"type": "bit"
					},
					{
						"name": "is_sick",
						"type": "bit"
					},
					{
						"name": "is_training",
						"type": "bit"
					},
					{
						"name": "is_vacation",
						"type": "bit"
					},
					{
						"name": "updated_at",
						"type": "nvarchar"
					},
					{
						"name": "ADF_TIMESTAMP",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "RUN_ID",
						"type": "nvarchar"
					}
				],
				"typeProperties": {
					"schema": "dbo",
					"table": "SF_SHIFT_PROD"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SQL_USER_CATEGORY_TABLE')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "eal_edw_connection",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "SQL tables"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {
					"schema": "dbo",
					"table": "SF_USER_CATEGORY_PROD"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SQL_USER_TABLE')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "eal_edw_connection",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "SQL tables"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {
					"schema": "dbo",
					"table": "SF_USER_PROD"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SourceDataset_qk2')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "eal_main_blob_connection",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "Binary",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"container": "radixx-source-tcn"
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/DELAYS trigger 7am')]",
			"type": "Microsoft.DataFactory/factories/triggers",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "ETL populates dbo.SF_DELAYS_PROD SQL Server table at 7 a.m. EDT",
				"annotations": [],
				"runtimeState": "Stopped",
				"type": "TumblingWindowTrigger",
				"typeProperties": {
					"frequency": "Hour",
					"interval": 24,
					"startTime": "2021-06-28T11:00:00Z",
					"delay": "00:00:00",
					"maxConcurrency": 50,
					"retryPolicy": {
						"count": 5,
						"intervalInSeconds": 240
					},
					"dependsOn": [
						{
							"type": "TumblingWindowTriggerDependencyReference",
							"referenceTrigger": {
								"referenceName": "AIRPORT trigger 7am",
								"type": "TriggerReference"
							}
						}
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/DELAYS trigger midnight UTC')]",
			"type": "Microsoft.DataFactory/factories/triggers",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "ETL populates dbo.SF_DELAYS_PROD SQL Server table at 00:00 EDT",
				"annotations": [],
				"runtimeState": "Stopped",
				"type": "TumblingWindowTrigger",
				"typeProperties": {
					"frequency": "Hour",
					"interval": 24,
					"startTime": "2021-10-22T23:45:00Z",
					"delay": "00:00:00",
					"maxConcurrency": 50,
					"retryPolicy": {
						"count": 5,
						"intervalInSeconds": 240
					},
					"dependsOn": [
						{
							"type": "TumblingWindowTriggerDependencyReference",
							"referenceTrigger": {
								"referenceName": "FLIGHT trigger midnight UTC",
								"type": "TriggerReference"
							}
						}
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/DELAYS trigger')]",
			"type": "Microsoft.DataFactory/factories/triggers",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "ETL populates dbo.SF_DELAYS_PROD SQL Server table",
				"annotations": [],
				"runtimeState": "Stopped",
				"type": "TumblingWindowTrigger",
				"typeProperties": {
					"frequency": "Hour",
					"interval": 24,
					"startTime": "2021-06-16T09:00:00Z",
					"delay": "00:00:00",
					"maxConcurrency": 50,
					"retryPolicy": {
						"intervalInSeconds": 30
					},
					"dependsOn": [
						{
							"type": "TumblingWindowTriggerDependencyReference",
							"referenceTrigger": {
								"referenceName": "AIRPORT trigger",
								"type": "TriggerReference"
							}
						}
					]
				}
			},
			"dependsOn": []
		}
	]
}